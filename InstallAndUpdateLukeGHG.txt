Install and update lukeghg python package, sorvi
---------------------------------------
Contents
-------
0 Create python virtual environment
A Install 'lukeghg' python package
B Basic workflow: GHG inventory to CRFReporter xml file
C Update  lukeghg
D Version control

The instructions are for zsh shell in sorvi.
(Your default shell might be for example "tcsh").

0 Create python virtual environment
----------------------------

1. Create python virtual environment called 'lukeghg' in your home directory
(promt% denotes your terminal command line prompt).

prompt% /usr/bin/python3 -m venv lukeghg

2. Activate the virtual environment

prompt% source lukeghg/bin/activate
(lukeghg) prompt%

Note the '(lukeghg)' appearing in front of your command prompt.

3. Check you have the latest versions of setuptools and wheel 
(lukeghg) prompt% python3 -m pip install --upgrade setuptools wheel

A Install 'lukeghg' python package
---------------------------

1. Install lukeghg python package to the virtual environment
   
Clone lukeghg from GitHub for example to /data/shared/<user>
(lukeghg) prompt% cd /data/shared/<user>
(lukeghg) prompt% mkdir <GHGInventoryDirectory>
(lukeghg) prompt% cd <GHGInventoryDirectory>
(lukeghg) prompt% git clone https://github.com/jariperttunen/lukeghg.git

2. Create the wheel package for lukeghg and install it 

(lukeghg) prompt% cd lukeghg/lukeghg
(lukeghg) prompt% python3 setup.py sdist bdist_wheel
(lukeghg) prompt% python3 -m pip install --upgrade dist/lukeghg-1.0-py3-none-any.whl

B.  Basic workflow: ghg inventory to CRFReporter xml file
---------------------------------------------

"run-ghg-master.sh" is a script that sets directories and files
for the current ghg inventory.

The "run-ghg-master.sh" is located in "<GHGInventoryDirectory>/lukeghg/lukeghg/lukeghg/bin"
directory. Edit the following command options:
-c Location of the GHG inventory files
-p Location of the CRFReporter PartyProfile file
-x Locatation of the PartyProfile result file to be imported to CRFReporter
-n Location of the specific NIR files
-i Location of the Comment files
-y Inventory year

Note the options -b, -k,-l and -m refer to ubiquitous configuration
files. They come with the lukeghg package. Thus after downloading
lukeghg from GitHub it is recommended to create "crf" and "PartyProfile"
directories in <GHGInventoryDirectory> and run the run-ghg-master.sh
in <GHGInventoryDirectory>.

When "run-ghg-master.sh" is edited for the current inventory
lukeghg must be updated for the virtual environment (see C Update lukeghg). 

Then the xml for CRFReporter can be produced:

(lukeghg) prompt%: python3 -m lukeghg.utility.convertuf8 -f crf/'*.csv'
(lukeghg) prompt%: run-ghg-master.sh > Import.log 2> Error.log

The GHG inventory result files (csv files) seem to use different encoding systems,
convertuf8 converts them to utf8 (this is why they need to be copied with scp to crf directory first). 
The script run-ghg-master.sh will run few minutes at most. 
The '>' character redirects 'standard out' terminal output to Import.log file 
and '2>' redirects 'standard error' terminal output to Error.log file.

For EU529 there is similar run-eu529-ghg-master.sh script. Note EU529
concerns KPLULUCF files only (LULUCF files are not missing by accident).

C Update lukeghg
----------------

You need to update lukeghg whenever you edit the files there (e.g. run-ghg-master.sh).
Otherewise changes will not appear available in the virtual environment,

1. If needed activate the virtual environment. 

prompt% source ~/lukeghg/bin/activate
(lukeghg) prompt%:

2. Update lukeghg

As with the first install recreate the wheel package, but now first remove
the lukeghg package and then upgrade lukeghg and its dependencies.

(lukeghg) prompt%: python3 setup.py sdist bdist_wheel
(lukeghg) prompt%: python3 -m pip uninstall lukeghg
(lukeghg) prompt%: python3 -m pip install --upgrade dist/lukeghg-1.0-py3-none-any.whl

D Version control
------------

Currently lukeghg is in GitHub. For smooth operation with Luke network
sample gitgonfig is available in Git directory. Edit email and your name and
install it as ".gitconfig" in your home directory.
